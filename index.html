<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript' src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
</head>
<body>
    <a-scene>
        <a-entity camera look-controls gps-new-camera='gpsMinDistance: 5'></a-entity>

        <a-entity track-user-movement></a-entity>
    </a-scene>
</body>
</html>

<script>
    AFRAME.registerComponent('track-user-movement', {
        tick: function () {
            let camera = this.el
            let cameraPosition = camera.getAttribute('position');

            console.log(cameraPosition)
        }
    })

    const options = {
        enableHighAccuracy: true,
        timeout: 1000,
        maximumAge: 0
    }

    const camera = document.querySelector('[gps-new-camera]')

    const urlParams = new URLSearchParams(window.location.search)
    const latitude = urlParams.get('latitude')
    const longitude = urlParams.get('longitude')

    if (latitude !== null && longitude !== null) {
        createBox(
            parseFloat(latitude),
            parseFloat(longitude)
        )
    }

    function createBox(latitude, longitude) {
        const box = document.createElement('a-box')

        box.setAttribute('material', {
            color: 'red'
        })

        box.setAttribute('scale', {
            x: 2,
            y: 2,
            z: 2
        })

        box.setAttribute('gps-new-entity-place', {
            latitude: latitude,
            longitude: longitude
        })

        document.querySelector('a-scene').appendChild(box)
    }


    function success(pos) {
        const crd = pos.coords

        camera.setAttribute('gps-new-entity-place', {
            latitude: crd.latitude,
            longitude: crd.longitude
        })
    }

    function error() {

    }

    navigator.geolocation.getCurrentPosition(
        success,
        error,
        options
    )
</script>