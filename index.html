<!DOCTYPE html>
<html>

<head>
    <title>AR.js A-Frame Location-based</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>
    <style>
        .pos {
            left: 0;
            bottom: 0;
            position: fixed;
        }
    </style>
</head>

<body>
    <a-scene vr-mode-ui='enabled: false' arjs='sourceType: webcam; videoTexture: true; debugUIEnabled: false'
        renderer='antialias: true; alpha: true'>
        <a-camera gps-new-camera='gpsMinDistance: 5'></a-camera>
    </a-scene>

    <div class="pos">
        <div class="pos-block"></div>
        <br>
        <div class="pos-camera"></div>
        <br>
        <div class="pos-pos"></div>
    </div>
</body>

</html>

<script>
    window.onload = () => {
        let testEntityAdded = false;

        const el = document.querySelector("[gps-new-camera]");
        const posBlock = document.querySelector('.pos-block')
        const posCamera = document.querySelector('.pos-camera')
        const posPos = document.querySelector('.pos-pos')

        // el.addEventListener("gps-camera-update-position", e => {
        //     if (!testEntityAdded) {
        //         alert(`Got first GPS position: lon ${e.detail.position.longitude} lat ${e.detail.position.latitude}`);
        //         // Add a box to the north of the initial GPS position
        //         const entity = document.createElement("a-box");
        //         entity.setAttribute("scale", {
        //             x: 20,
        //             y: 20,
        //             z: 20
        //         });
        //         entity.setAttribute('material', { color: 'red' });
        //         entity.setAttribute('gps-new-entity-place', {
        //             latitude: e.detail.position.latitude + 0.001,
        //             longitude: e.detail.position.longitude
        //         });

        //         posBlock.innerHTML = `Block:<br>latitude: ${e.detail.position.latitude + 0.001}<br>longitude: ${e.detail.position.longitude}`

        //         document.querySelector("a-scene").appendChild(entity);

        //     }
        //     testEntityAdded = true;

        //     posCamera.innerHTML = `Camera:<br>latitude: ${e.detail.position.latitude}<br>longitude: ${e.detail.position.longitude}`
        // });

        const mult = 10

        function createBox(latitude, longitude) {
            if (testEntityAdded) return

            const entity = document.createElement("a-box");

            entity.setAttribute('material', {
                color: 'red'
            });

            entity.setAttribute("scale", {
                x: 20,
                y: 20,
                z: 20
            });

            entity.setAttribute('position', {
                x: latitude * mult,
                y: 0,
                z: longitude * mult
            });

            posBlock.innerHTML = `Block:<br>latitude: ${latitude * mult}<br>longitude: ${longitude * mult}`

            testEntityAdded = true
        }

        const options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0,
        };

        function success(pos) {
            const crd = pos.coords;

            posPos.innerHTML = `Your current position:<br>latitude: ${crd.latitude * mult}<br>longitude: ${crd.longitude * mult}<br>accuracy: ${crd.accuracy}`

            el.setAttribute('position', {
                x: crd.latitude * mult,
                y: 0,
                z: crd.longitude * mult
            });

            // posCamera.innerHTML = `Camera:<br>latitude: ${e.detail.position.latitude}<br>longitude: ${longitude}`

            setTimeout(() => {
                navigator.geolocation.getCurrentPosition(success, error, options);
            }, 5000)
        }

        function error(err) {
            // console.warn(`ERROR(${err.code}): ${err.message}`);
            alert(`ERROR(${err.code}): ${err.message}`)

            setTimeout(() => {
                navigator.geolocation.getCurrentPosition(success, error, options);
            }, 5000)
        }

        navigator.geolocation.getCurrentPosition(success, error, options);
    };
</script>