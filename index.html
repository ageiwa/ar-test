<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://libs.zappar.com/zappar-aframe/2.0.0/zappar-aframe.js"></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar-threex-location-only.js'></script>
    <script type='text/javascript'
        src='https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js'></script>

    <meta charset="utf-8" />
    <title>Zappar for A-Frame: Instant Tracking 3D Model Example</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <a-scene>
        <a-entity zappar-permissions-ui id="permissions"></a-entity>
        <a-entity zappar-compatibility-ui id="compatibility"></a-entity>

        <a-camera zappar-camera gps-new-camera='gpsMinDistance: 5' />

        <a-entity zappar-instant="placement-mode: false" id="instant-tracker">

        </a-entity>
    </a-scene>

    <script>
        const options = {
            enableHighAccuracy: true,
            timeout: 1000,
            maximumAge: 0
        }

        const camera = document.querySelector('[gps-new-camera]')

        const urlParams = new URLSearchParams(window.location.search)
        const latitude = urlParams.get('latitude')
        const longitude = urlParams.get('longitude')

        if (latitude !== null && longitude !== null) {
            createBox(
                parseFloat(latitude),
                parseFloat(longitude)
            )
        }

        let idPos = null

        function createBox(latitude, longitude) {
            const instantTracker = document.querySelector('#instant-tracker')

            instantTracker.setAttribute('gps-new-entity-place', {
                latitude: latitude,
                longitude: longitude
            })

            const box = document.createElement('a-box')

            box.setAttribute('material', {
                color: 'red'
            })

            box.setAttribute('scale', {
                x: 20,
                y: 20,
                z: 20
            })

            instantTracker.appendChild(box)
        }

        function success(pos) {
            const crd = pos.coords

            camera.setAttribute('gps-new-entity-place', {
                latitude: crd.latitude,
                longitude: crd.longitude
            })

            navigator.geolocation.clearWatch(idPos)
        }

        function error() {
            // setTimeout(getPosition, 5000)
        }

        idPos = navigator.geolocation.watchPosition(
            success,
            error,
            options
        )
    </script>
</body>

</html>